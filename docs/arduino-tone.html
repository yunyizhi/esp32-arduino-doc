<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-08-02T13:33:46.9470847"><title>arduino Tone | Esp32 Arduino API参考</title><script type="application/json" id="virtual-toc-data">[{"id":"tone","level":0,"title":"tone","anchor":"#tone"},{"id":"notone","level":0,"title":"noTone","anchor":"#notone"},{"id":"ledc-esp32","level":0,"title":"设置ledc通道(esp32独有)","anchor":"#ledc-esp32"},{"id":"ov5noz_71","level":0,"title":"将乐谱翻译为控制时序","anchor":"#ov5noz_71"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="arduino Tone | Esp32 Arduino API参考"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Esp32 Arduino API参考 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/arduino-tone.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="arduino Tone | Esp32 Arduino API参考"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/arduino-tone.html#webpage",
    "url": "writerside-documentation/arduino-tone.html",
    "name": "arduino Tone | Esp32 Arduino API参考",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Esp32 Arduino API参考 Help"
}</script><!-- End Schema.org --></head><body data-id="arduino_tone" data-main-title="arduino Tone" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="API///esp-hal///arduino_common.md|arduino 通用api"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Esp32 Arduino API参考  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="arduino_tone" id="arduino_tone.md">arduino Tone</h1><p id="ov5noz_60">用于输出一定频率的pwm,可以让扬声器或者蜂鸣器发声。</p><section class="chapter"><h2 id="tone" data-toc="tone">tone</h2><p id="ov5noz_61">发声 <code class="code" id="ov5noz_62">void tone(uint8_t _pin, unsigned int frequency, unsigned long duration = 0)</code></p><ul class="list _bullet" id="ov5noz_63"><li class="list__item" id="ov5noz_64"><p>pin 引脚</p></li><li class="list__item" id="ov5noz_65"><p>frequency频率</p></li><li class="list__item" id="ov5noz_66"><p>duration持续时间</p></li></ul></section><section class="chapter"><h2 id="notone" data-toc="notone">noTone</h2><p id="ov5noz_67">停止发声 <code class="code" id="ov5noz_68">void noTone(uint8_t _pin)</code></p></section><section class="chapter"><h2 id="ledc-esp32" data-toc="ledc-esp32">设置ledc通道(esp32独有)</h2><p id="ov5noz_69"><code class="code" id="ov5noz_70">void setToneChannel(uint8_t channel = 0)</code> esp32的tone 依赖ledc实现，可以设置使用的ledc通道。</p></section><section class="chapter"><h2 id="ov5noz_71" data-toc="ov5noz_71">将乐谱翻译为控制时序</h2><p id="ov5noz_72">1939年在伦敦的国际会议上决定，以小字一组的A为标准音，机械波为440Hz、波长为78cm。</p><figure id="ov5noz_73"><img alt="panio_key.png" src="images/panio_key.png" title="panio_key.png" width="1644" height="506"></figure><p id="ov5noz_74">可以看出每组七个白键，5个黑键。如小字一组c到小字二组c,有十二份最小间隔(最小间隔是一个半音关系)。</p><p id="ov5noz_75">自然泛音中，频率翻一倍则是弦长一半分段振动，我们以二倍一个八度。也就是二倍频率关系对于这十二份间隔。 我们为了方便转调，将每份间隔均等划分，也就是十二平均律的做法。也就是将二倍划分开十二次根号得到最小间隔。</p><p id="ov5noz_76">那一个半音关系就是 十二次根号下2， 同时这里有了标准音 440Hz，根据音的距离，乘除对应个数量的半音关系倍数（十二次根号下2）即可得到对应音的频率。 （当然音高较高区域人类听觉会与真实倍数有偏差，较高区域实际调音可能需要依靠经验。）</p><figure id="ov5noz_77"><img alt="LittleStar.png" src="images/LittleStar.png" title="LittleStar.png" width="766" height="602"></figure><p id="ov5noz_78">这里还需要理解音符的时值，我们可以简单的通过音符名称，全音符二分音符四分音符八分音符等等，理解他们直接的时值的倍数。像其他的三连音五连音，以及附点音符可以自行研究。</p><p id="ov5noz_79">拍号只是决定以什么音符为一拍，一小节几拍。如4/4 就是4分音符一拍，一小节四拍。2/4则是一小节二拍不能直接影响速度。</p><p id="ov5noz_80">有些乐谱有严格速度标记， 如<code class="code" id="ov5noz_81">♩=60</code> ，就是一分钟60个四分音符。此外还有 速度术语 带修饰性的 如<code class="code" id="ov5noz_82">慢板</code>或者<code class="code" id="ov5noz_83">缓慢地</code>或者意大利语对应的含义。</p><div class="code-block" data-lang="cpp">
#include &lt;Arduino.h&gt;

const int stdStep = 400;
// 音符之间的间隔， 因为没有连音符号情况下，时值其实是不足完整的节拍时间，不然音会连起来。
const int stepDelay = stdStep / 10;

// 四分音符时值
const int step = 400 - stepDelay;

int twoStep = stdStep * 2 - stepDelay;

const uint8_t pin = 1;

#define C4 262
#define D4 294
#define E4 330
#define F4 349
#define G4 392
#define A4 440
#define B4 494

void setup() {

}


void play(unsigned int frequency, unsigned long duration) {
    noTone(pin);
    tone(pin, frequency, duration);
    delay(duration + stepDelay);
}

void loop() {
    // 11 55 66 5-
    play(C4, step);
    play(C4, step);
    play(G4, step);
    play(G4, step);
    play(A4, step);
    play(A4, step);
    play(G4, twoStep);
    // 44 33 22 1-
    play(F4, step);
    play(F4, step);
    play(E4, step);
    play(E4, step);
    play(D4, step);
    play(D4, step);
    play(C4, twoStep);
    // 55 44 33 2-
    play(G4, step);
    play(G4, step);
    play(F4, step);
    play(F4, step);
    play(E4, step);
    play(E4, step);
    play(D4, twoStep);
    // 55 44 33 2-
    play(G4, step);
    play(G4, step);
    play(F4, step);
    play(F4, step);
    play(E4, step);
    play(E4, step);
    play(D4, twoStep);
    // 11 55 66 5-
    play(C4, step);
    play(C4, step);
    play(G4, step);
    play(G4, step);
    play(A4, step);
    play(A4, step);
    play(G4, twoStep);
    // 44 33 22 1-
    play(F4, step);
    play(F4, step);
    play(E4, step);
    play(E4, step);
    play(D4, step);
    play(D4, step);
    play(C4, twoStep);
    delay(1000);
}


</div><p id="ov5noz_85">实际使用过程中，可以将时序存入数组。音范围数量有限，可以只存一份频率，用更小范围的数字音名，同时音符时值也是同理，不用存具体延时，而只是音符类型。</p><p id="ov5noz_86">关于计算机可以理解的乐谱，通常是MIDI文件，会记录音高力度音色等等信息，不含真正的波形，类似乐谱，所以MIDI音乐不会太占空间。</p><p id="ov5noz_87">我们也可以通过解析midi来播放。</p></section><div class="last-modified">Last modified: 02 八月 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="arduino-time.html" class="navigation-links__prev">arduino 时间</a><a href="arduino-digital-io.html" class="navigation-links__next">Arduino 数字IO</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.js"></script></body></html>