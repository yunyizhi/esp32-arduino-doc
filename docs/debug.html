<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-09-30T09:46:25.707643"><title>jtag调试 | Esp32 Arduino API参考</title><script type="application/json" id="virtual-toc-data">[{"id":"-xbbiae_6","level":0,"title":"代码","anchor":"#-xbbiae_6"},{"id":"platformio","level":0,"title":"使用platformio调试","anchor":"#platformio"},{"id":"arduino-ide-esp32c3-esp32s3","level":0,"title":"使用arduino ide调试esp32c3和esp32s3","anchor":"#arduino-ide-esp32c3-esp32s3"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b408/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="jtag调试 | Esp32 Arduino API参考"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Esp32 Arduino API参考 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/debug.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="jtag调试 | Esp32 Arduino API参考"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/debug.html#webpage",
    "url": "writerside-documentation/debug.html",
    "name": "jtag调试 | Esp32 Arduino API参考",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Esp32 Arduino API参考 Help"
}</script><!-- End Schema.org --></head><body data-id="debug" data-main-title="jtag调试" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Esp32 Arduino API参考  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="debug" id="debug.md">jtag调试</h1><p id="-xbbiae_3">这里介绍基于arduino 环境的debug，本质也是使用OpenOCD调试环境。</p><p id="-xbbiae_4">参考<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v5.2.2/esp32s3/api-guides/jtag-debugging/index.html" id="-xbbiae_55" data-external="true" rel="noopener noreferrer">IDF JTAG 调试</a></p><p id="-xbbiae_5">目前这里只提供esp32c3 esp32s3等内置jtag调试配置方法。( 由于目前外接调试器暂未使用官方调试器尝试，使用第三方的，暂未在arduino下测试成功。)</p><section class="chapter"><h2 id="-xbbiae_6" data-toc="-xbbiae_6">代码</h2><p id="-xbbiae_56">代码如下</p><div class="code-block" data-lang="cpp">
#include &lt;Arduino.h&gt;

void setup() {
    uint8_t mac_base[6] = {0};
    if (esp_efuse_mac_get_default(mac_base) == ESP_OK) {
        log_i(&quot;efuse mac :%02X:%02X:%02X:%02X:%02X:%02X&quot;, mac_base[0], mac_base[1], mac_base[2], mac_base[3],
              mac_base[4], mac_base[5]);
    } else {
        log_e(&quot;get efuse mac failed&quot;);
    }
}

void loop() {
    delay(1000);
}
</div></section><section class="chapter"><h2 id="platformio" data-toc="platformio">使用platformio调试</h2><section class="chapter"><h3 id="esp32s3-platformio" data-toc="esp32s3-platformio">esp32s3 platformio配置</h3><p id="-xbbiae_43">选择<code class="code" id="-xbbiae_45">esp32-s3-devkitc-1</code>并不需要额外为debug配置其他参数，因为默认debug_tool就是使用内置jtag已经在boards下的json文件中配置好了。</p><div class="code-block" data-lang="ini">
[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600
</div></section><section class="chapter"><h3 id="esp32c3-platformio" data-toc="esp32c3-platformio">合宙esp32c3 platformio配置</h3><p id="-xbbiae_46">由于boards下的json文件未指定内置jtag调试，这里配置debug_tool选项为 <code class="code" id="-xbbiae_58">esp-builtin</code></p><div class="code-block" data-lang="ini">
[env:airm2m_core_esp32c3]
platform = espressif32
board = airm2m_core_esp32c3
framework = arduino
debug_tool = esp-builtin
monitor_speed = 115200
upload_speed = 921600
</div></section><section class="chapter"><h3 id="clion-debug" data-toc="clion-debug">使用clion点击debug一键调试</h3><p id="-xbbiae_59">s3需要将usb jtag口连接至pc,而合宙esp32c3只有一个usb口便是jtag。</p><figure id="-xbbiae_60"><img alt="clion_debug.png" src="images/clion_debug.png" title="clion_debug.png" width="1659" height="742"></figure></section><section class="chapter"><h3 id="clion" data-toc="clion">clion操作外设寄存器</h3><section class="chapter"><h4 id="svd" data-toc="svd">加载svd文件</h4><figure id="-xbbiae_62"><img alt="clion_peripheral.png" src="images/clion_peripheral.png" title="clion_peripheral.png" width="1823" height="966"></figure><p id="-xbbiae_63">选择以下目录中的svd文件</p><div class="tabs" id="-xbbiae_64" data-anchors="[-xbbiae_65,-xbbiae_66]"><div class="tabs__content" data-gtm="tab" id="-xbbiae_65" data-title="Windows"><div class="code-block" data-lang="plaintext" data-title="Plain Text">C:\Users\用户名\.platformio\packages\framework-arduinoespressif32\tools\ide-debug\svd</div></div><div class="tabs__content" data-gtm="tab" id="-xbbiae_66" data-title="Linux"><div class="code-block" data-lang="plaintext" data-title="Plain Text">/home/用户名/.platformio/packages/framework-arduinoespressif32/tools/ide-debug/svd
          </div></div></div><p> 如果已加载的svd不符合芯片类型,可以右键hide</p></section></section><section class="chapter"><h3 id="-xbbiae_18" data-toc="-xbbiae_18">修改寄存器</h3><p id="-xbbiae_20">外设这里只有读取和复制值等功能</p><p id="-xbbiae_21">可以复制寄存器地址到gdb控制台进行操作</p><figure id="-xbbiae_24"><img alt="clion_reg_copy.png" src="images/clion_reg_copy.png" title="clion_reg_copy.png" width="1024" height="468"></figure><section class="chapter"><h4 id="gpio" data-toc="gpio">gpio操作例子</h4><p id="-xbbiae_28">具体外设可以参考idf 指南中关联的<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32s3/hw-reference/index.html" id="-xbbiae_39" data-external="true" rel="noopener noreferrer">硬件参考</a>里面的 <span class="control" id="-xbbiae_42">技术参考手册 (PDF)</span></p><p id="-xbbiae_30"><span class="control" id="-xbbiae_69">这里用到三个寄存器</span></p><div class="table-wrapper"><table class="wide" id="-xbbiae_32"><thead><tr class="ijRowHead" id="-xbbiae_48"><th id="-xbbiae_52"><p>名称</p></th><th id="-xbbiae_53"><p>地址</p></th><th id="-xbbiae_54"><p>说明</p></th></tr></thead><tbody><tr id="-xbbiae_49"><td id="-xbbiae_70"><p><code class="code" id="-xbbiae_73">ENABLE_W1TS</code></p></td><td id="-xbbiae_71"><p>0x60004024</p></td><td id="-xbbiae_72"><p>设置输出模式</p></td></tr><tr id="-xbbiae_50"><td id="-xbbiae_74"><p><code class="code" id="-xbbiae_77">OUT_W1TS</code></p></td><td id="-xbbiae_75"><p>0x60004008</p></td><td id="-xbbiae_76"><p>设置为高</p></td></tr><tr id="-xbbiae_51"><td id="-xbbiae_78"><p><code class="code" id="-xbbiae_81">OUT_W1TC</code></p></td><td id="-xbbiae_79"><p>0x6000400c</p></td><td id="-xbbiae_80"><p>设置为低</p></td></tr></tbody></table></div><aside class="prompt" data-type="tip" data-title="" id="-xbbiae_33"><p id="-xbbiae_82">s3引脚不止32个，多出的引脚在ENABLE1_XXX OUT1_XXX相关寄存器。</p></aside><p id="-xbbiae_35">比如在gdb 控制台操作2号引脚可以依次输入以下命令可以操作io2输出高低电平</p><div class="code-block" data-lang="bash">
set {uint32_t } 0x60004024 |= (1 &lt;&lt; 2)
set {uint32_t } 0x60004008 |= (1 &lt;&lt; 2)
set {uint32_t } 0x6000400c |= (1 &lt;&lt; 2)
</div></section></section></section><section class="chapter"><h2 id="arduino-ide-esp32c3-esp32s3" data-toc="arduino-ide-esp32c3-esp32s3">使用arduino ide调试esp32c3和esp32s3</h2><section class="chapter"><h3 id="esp32c3-arduino-ide" data-toc="esp32c3-arduino-ide">合宙esp32c3 arduino ide 菜单配置</h3><p id="-xbbiae_87">由于在 <a href="https://github.com/espressif/arduino-esp32/blob/master/boards.txt" id="-xbbiae_90" data-external="true" rel="noopener noreferrer">arduino-esp32 boards.txt</a>中未配置 合宙C3的Jtag选项。 导致无法指定调试使用的JTAG,为了debug不要选择<code class="code" id="-xbbiae_91">AirM2M_CORE_ESP32C3</code>而使用通用的<code class="code" id="-xbbiae_92">ESP32C3 Dev Module</code>。</p><p id="-xbbiae_88">合宙C3采用的是DIO方式外接flash，这里需要将<code class="code" id="-xbbiae_93">Flash Mode</code> 设为<code class="code" id="-xbbiae_94">DIO</code>。</p><p id="-xbbiae_89">然后选择JTAG Adaptor为<code class="code" id="-xbbiae_95">Integrated USB JTAG</code>表示使用C3内嵌的JTAG进行debug。</p></section><section class="chapter"><h3 id="esp32s3-arduino-ide" data-toc="esp32s3-arduino-ide">esp32s3 arduino ide 菜单配置</h3><p id="-xbbiae_96">设置USB模式为JTAG, JTAG Adaptor选择<code class="code" id="-xbbiae_98">Integrated USB JTAG</code> 便可用内置jtag 调试</p><figure id="-xbbiae_97"><img alt="s3_debug_config.png" src="images/s3_debug_config.png" title="s3_debug_config.png" width="703" height="742"></figure></section><section class="chapter"><h3 id="-xbbiae_85" data-toc="-xbbiae_85">开始调试</h3><p id="-xbbiae_99">s3需要将usb jtag口连接至pc,而合宙esp32c3只有一个usb口便是jtag。</p><p id="-xbbiae_100">点击对钩进行<code class="code" id="-xbbiae_104">验证</code> (也就是编译，直接debug不会触发编译而是报文件找不到。)</p><p id="-xbbiae_101">点击debug</p><figure id="-xbbiae_102"><img alt="ard_debug.png" src="images/ard_debug.png" title="ard_debug.png" width="1267" height="699"></figure><p id="-xbbiae_103">即可调试，注意看调试控制台的打印。</p></section><section class="chapter"><h3 id="-xbbiae_86" data-toc="-xbbiae_86">外设寄存器</h3><p id="-xbbiae_105">查看和读取寄存器，可以在左下角找到<code class="code" id="-xbbiae_109">CORTEX PERIPHERAL</code></p><figure id="-xbbiae_106"><img alt="debug_reg.png" src="images/debug_reg.png" title="debug_reg.png" width="966" height="645"></figure><p id="-xbbiae_107">可以复制各种外设寄存器的值，也可以使用编辑按钮设置。</p><p id="-xbbiae_108">具体外设可以参考idf 指南中关联的<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32s3/hw-reference/index.html" id="-xbbiae_110" data-external="true" rel="noopener noreferrer">硬件参考</a>里面的 <span class="control" id="-xbbiae_111">技术参考手册 (PDF)</span></p></section></section><div class="last-modified">Last modified: 30 九月 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="serial.html" class="navigation-links__prev">串口</a><a href="doc-navigation.html" class="navigation-links__next">esp32文档导航</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b408/app.js"></script></body></html>